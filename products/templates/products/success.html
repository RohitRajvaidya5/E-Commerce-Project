{% extends "base.html" %}

{% block content %}

<div class="max-w-lg mx-auto mt-20 bg-base-100 p-10 rounded-2xl shadow-xl border border-base-300 text-center relative overflow-hidden">

    <!-- CONFETTI CANVAS -->
    <canvas id="confettiCanvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>

    <!-- CHECKMARK -->
    <div class="flex justify-center mb-4">
        <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center shadow-md">
            <svg id="checkmark" xmlns="http://www.w3.org/2000/svg"
                 class="w-10 h-10 text-green-600"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor"
                 style="stroke-dasharray: 100; stroke-dashoffset: 100;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M5 13l4 4L19 7"/>
            </svg>
        </div>
    </div>

    <!-- HEADING -->
    <h1 class="text-3xl font-extrabold text-green-600 mb-3">
        Payment Successful!
    </h1>

    <p class="text-base-content/70 mb-6 text-sm">
        Thank you for your order. A confirmation email has been sent.
    </p>

    <!-- ORDER SUMMARY -->
    <div class="bg-base-200 p-4 rounded-xl mb-8 border border-base-300 text-left">
        <h3 class="text-lg font-semibold mb-2">Order Summary</h3>

        <p class="text-sm">
            <span class="font-medium">Total Paid:</span>
            <span class="font-bold text-primary">â‚¹{{ total }}</span>
        </p>

        {% if order_id %}
        <p class="text-sm mt-1">
            <span class="font-medium">Order ID:</span> {{ order_id }}
        </p>
        {% endif %}
    </div>

    <!-- Loader -->
    <div id="loaderBox" class="flex flex-col items-center mb-4 invisible">
        <span class="loading loading-spinner loading-lg text-primary"></span>
        <p class="mt-3 text-primary font-medium text-sm">Taking you back...</p>
    </div>

    <!-- BUTTON -->
    <a id="shopBtn" href="{% url 'products' %}" class="btn btn-primary btn-wide font-semibold shadow-md">
        Continue Shopping
    </a>
</div>

<!-- SCRIPTS -->
<script>
/* Smooth checkmark drawing */
setTimeout(() => {
    const check = document.getElementById("checkmark");
    check.style.transition = "stroke-dashoffset 0.8s ease-out";
    check.style.strokeDashoffset = "0";
}, 300);

/* Confetti burst */
setTimeout(() => {
    confetti({
        particleCount: 200,
        spread: 70,
        origin: { y: 0.6 }
    });
}, 200);

/* Smooth redirect with loader */
const btn = document.getElementById("shopBtn");
const loader = document.getElementById("loaderBox");

btn.addEventListener("click", (e) => {
    e.preventDefault();
    btn.classList.add("invisible");
    loader.classList.remove("invisible");

    setTimeout(() => {
        window.location.href = btn.href;
    }, 900);
});
</script>

<!-- Correct confetti library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

{% endblock %}
